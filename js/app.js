window.appWillLaunch = function () {yum.enable(false);yum.define([],function(){class Model extends Pi.Model.Abstract{instances(){};init(){super.init(Pi.Url.create(App.getConfig('netune.api'),'/musica'));};validators(add){add({});};initWithJson(json){super.initWithJson(json);return this;};actions(add){super.actions(add);add({get:'GET:/get?id=:id',all:'GET:/all'});}};Pi.Export('Music.Model',Model);});yum.define([Pi.Url.create('Music','/parser.js')],function(html){class Control extends Pi.Component{instances(){this.view=new Pi.View(`<div class="page"><div class="navbar"><div class="navbar-bg"></div><div class="navbar-inner"><div class="left"><a href="javascript:void(0)"id="backPage"class="link back"><i class="icon icon-back"></i></a></div><div class="title"id="title">Título</div><div class="right"><a href="javascript:void(0)"id="save"class="link back"><i class="fas fa-save"style="font-size: 26px; color: #6200ee;"></i></a></div></div></div><div class="page-content"><textarea placeholder="\nMusica\nGrande é o Senhor\n\nTom\nA\n\nEstrofe\nA\nGrande é o senhor e muito digno de louvor\nD                  E\nNa cidade do nosso Deus, seu santo monte\nA\nAlegria de toda terra\n\nEstrofe\nA\nGrande é o senhor em quem nós temos a vitória\nD              E       A   \nQue nos ajuda contra o inimigo\nA                         Bm7     A/C#\nPor isso diante dele nos prostramos\n\nCoro\nA                      C#m\nQueremos o seu nome engrandecer\nA           A/C#       D             E            \nE agradecer-te por tua obra em nossa vida\nA                         C#m7\nConfiamos em teu infinito amor\n      D         A/C#        Bm7        E       A\nPois só tu és o Deus eterno sobre toda terra e céus"id="textarea"style="width: 100%; height: 100%"></textarea></div></div>`);};viewDidLoad(){super.viewDidLoad();};set(musica){this.musica=musica;this.view.get('title').set(this.musica.nome);this.view.get('textarea').set(musica.lyrics);};events(listen){super.events(listen);listen({'#save click'(){if(this.musica==null)return;try{var parser=new Music.Parser();var letra=this.view.textarea.get();var lyrics=parser.parse(letra);this.musica.nome=lyrics.titulo;this.musica.versao=lyrics.versao;this.musica.tom=lyrics.tom;this.musica.lyrics=letra;if(this.musica.nome.length==0){throw'Informe o nome da música';};if(this.musica.tom.length==0){throw'Informe o tom da música';};if(this.musica.versao.length==0){this.musica.versao='Original';};app.loading(true);this.musica.save().ok(()=>{app.event.trigger('save:music',this.musica);app.popPage();}).error(()=>{app.notification('Atenção!','Sem conexão com a internet');}).done(()=>{app.loading(false);});}catch(error){app.notification('Atenção!','Cifra não esta formatada corretamente',error);}},'#backPage click':function(){app.popPage();}});}};Pi.Export('Music.Editor',Control);});yum.define([Pi.Url.create('Music','/lyrics.js'),Pi.Url.create('Lexicon','/automate.js')],function(){class Parser extends Pi.Class{instances(){this.automate=new Lexicon.Automate();this.tags=['youtube','nome','musica','titulo','intro','tom','versao','estrofe','ponte','coro'];this.automate.add(0,0,['[empty]']);this.automate.add(0,1,['estrofe','ponte','coro']);this.automate.add(1,2,['[text]']);this.automate.add(1,4,['[empty]']);this.automate.add(4,4,['[empty]']);this.automate.add(4,2,['[text]']);this.automate.add(2,2,['[text]','[empty]']);this.automate.add(2,3,['[empty]']);this.automate.add(2,3,['[done]']);this.automate.add(2,3,this.tags);this.automate.add(0,4,['youtube','nome','musica','titulo','intro','tom','versao']);this.automate.add(4,5,['[text]']);this.automate.add(4,6,['[empty]']);this.automate.add(6,6,['[empty]']);this.automate.add(6,5,['[text]']);this.automate.add(5,3,['[empty]']);this.automate.add(5,3,['[done]']);this.automate.add(5,3,this.tags);this.automate.doneOn(3);};parse(text){var lyrics=new Music.Lyrics();var linhas=text.replace(/\r/gi,'').split('\n');var values=[];this.automate.onStart(()=>{values=[];});this.automate.onDone(()=>{const events=this.automate.events;lyrics.add(events[0],values);});for(let i=0;i<linhas.length;i++){const linhaRaw=linhas[i];const linha=this.clear(linhaRaw);const event=this.convertToEvent(linha);this.automate.onStep(()=>{values.push(linhaRaw);});this.automate.onInvalid(()=>{throw'Erro na linha '+(i+1);});this.automate.trigger(event);};this.automate.onStep(null);this.automate.trigger('[done]');return lyrics;};convertToEvent(linha){if(this.tags.indexOf(linha)>-1)return linha;if(linha.length==0)return'[empty]';return'[text]';};isEmpty(linha){return linha.length==0;};clear(linha){linha=linha.replace(/\s/gi,'');linha=linha.replace(/\t/gi,'');return linha.toLowerCase();}};Pi.Export('Music.Parser',Parser);});yum.define([],function(html){class Control extends Pi.Component{instances(){this.view=new Pi.View(`<div class="swiper-container"><div class="swiper-pagination swiper-pagination-bullets"style="bottom: 0px;"></div><!--Slides wrapper--><div class="swiper-wrapper"id="slides"></div></div>`);};load(lyrics,lineHeight=22){if(this._swiper){this.view.get('slides').html('');this._swiper.destroy();};var pageHeight=this.view.element.parent().query().height()+2;var maxlines=pageHeight/lineHeight;var rows=this.createRows(lyrics);var pages=this.createPages(rows,maxlines);for(let i=0;i<pages.length;i++){this.createSlide(pages[i].join(''));};this.createSwiper();};createPages(rows,maxlines){var pages=[];var pageNumber=0;for(let i=0;i<rows.length;i++){const row=rows[i];if(pages[pageNumber]==undefined){pages[pageNumber]=[];};if(pages[pageNumber].length>=maxlines-1){pages[pageNumber+1]=[];if(!row.isBreakable){for(var j=i-1;j>=0;j--){if(!rows[j].isMoveable)continue;if(rows[j].isBreakable){for(let w=j;w<pages[pageNumber].length;){pages[pageNumber+1].push(pages[pageNumber][w]);pages[pageNumber].splice(w,1);};break;}}};pageNumber++;};pages[pageNumber].push(row.content);};return pages;};createRows(lyrics){var rows=[];for(let i=0;i<lyrics.tokens.length;i++){const token=lyrics.tokens[i];if(token.isTitle){rows.push({isMoveable:false,isBreakable:false,content:'\n'});rows.push({isMoveable:true,isBreakable:true,content:`\n<span style="padding: 0 20px; background-color: #ffff00;color: #333; font-weight: bold;">${token.key}</span>`});if(token.value.length>0){rows.push({isMoveable:true,isBreakable:false,content:`\n<span style="color: #ff0000; font-weight: bold;">${token.value}</span>`});}}else{rows.push({isMoveable:true,isBreakable:token.isBreakable,content:`\n<span style="color: #ff0000; font-weight: bold;">${token.key}</span>`});if(token.tag=='CORO'){rows.push({isMoveable:true,isBreakable:false,content:`\n<span style="color: #19b861">${token.value}</span>`});}else{rows.push({isMoveable:true,isBreakable:false,content:`\n<span style="">${token.value}</span>`});}}};return rows;};createSlide(text){this.view.get('slides').append(`<div class="swiper-slide"style="background: #fff"><pre>${text}</pre></div>`);};createSwiper(){this._swiper=app.f7.swiper.create('#'+this.view.id,{loop:true,pagination:{el:'.swiper-pagination',type:'bullets',},});};destroy(){this._swiper.destroy();super.destroy();}};Pi.Export('Music.Slider',Control);});yum.define([],function(){class Model extends Pi.Model.Abstract{instances(){};init(){super.init(Pi.Url.create(App.getConfig('netune.api'),'/musica'));};validators(add){add({});};initWithJson(json){super.initWithJson(json);return this;};actions(add){super.actions(add);add({get:'GET:/get?id=:id',all:'GET:/all'});}};Pi.Export('Music.Model',Model);});yum.define([Pi.Url.create('Music','/lyrics.js'),Pi.Url.create('Lexicon','/automate.js')],function(){class Parser extends Pi.Class{instances(){this.automate=new Lexicon.Automate();this.tags=['youtube','nome','musica','titulo','intro','tom','versao','estrofe','ponte','coro'];this.automate.add(0,0,['[empty]']);this.automate.add(0,1,['estrofe','ponte','coro']);this.automate.add(1,2,['[text]']);this.automate.add(1,4,['[empty]']);this.automate.add(4,4,['[empty]']);this.automate.add(4,2,['[text]']);this.automate.add(2,2,['[text]','[empty]']);this.automate.add(2,3,['[empty]']);this.automate.add(2,3,['[done]']);this.automate.add(2,3,this.tags);this.automate.add(0,4,['youtube','nome','musica','titulo','intro','tom','versao']);this.automate.add(4,5,['[text]']);this.automate.add(4,6,['[empty]']);this.automate.add(6,6,['[empty]']);this.automate.add(6,5,['[text]']);this.automate.add(5,3,['[empty]']);this.automate.add(5,3,['[done]']);this.automate.add(5,3,this.tags);this.automate.doneOn(3);};parse(text){var lyrics=new Music.Lyrics();var linhas=text.replace(/\r/gi,'').split('\n');var values=[];this.automate.onStart(()=>{values=[];});this.automate.onDone(()=>{const events=this.automate.events;lyrics.add(events[0],values);});for(let i=0;i<linhas.length;i++){const linhaRaw=linhas[i];const linha=this.clear(linhaRaw);const event=this.convertToEvent(linha);this.automate.onStep(()=>{values.push(linhaRaw);});this.automate.onInvalid(()=>{throw'Erro na linha '+(i+1);});this.automate.trigger(event);};this.automate.onStep(null);this.automate.trigger('[done]');return lyrics;};convertToEvent(linha){if(this.tags.indexOf(linha)>-1)return linha;if(linha.length==0)return'[empty]';return'[text]';};isEmpty(linha){return linha.length==0;};clear(linha){linha=linha.replace(/\s/gi,'');linha=linha.replace(/\t/gi,'');return linha.toLowerCase();}};Pi.Export('Music.Parser',Parser);});yum.define([],function(){class Automato extends Pi.Class{instances(){this.nodes=[];this.done=-1;this.reset();};add(from,to,events){for(let i=0;i<events.length;i++){const event=events[i];this.nodes[`${from}:${event}`]=to;};return this;};doneOn(done){this.done=done;return this;};onStart(cb){this._cbStart=cb;};onStep(cb){this._cbStep=cb;};onDone(cb){this._cbDone=cb;};onInvalid(cb){this._cbInvalid=cb;};trigger(event){if(!this.exist(this.current,event)){this.current=-1;if(this._cbInvalid)this._cbInvalid();return;};const from=this.current;const to=this.get(from,event);if(from==0&&to>0){this.reset();if(this._cbStart)this._cbStart(event);}else if(from>0&&to>0){if(this._cbStep)this._cbStep(event);};this.events.push(event);this.current=to;if(this.isDone()){if(this._cbDone)this._cbDone();this.reset();}};reset(){this.current=0;this.events=[];return this;};get(from,event){return this.nodes[`${from}:${event}`];};exist(from,event){return this.get(from,event)!==undefined;};isValid(){return this.current!=-1;};isDone(){return this.current==this.done;}};Pi.Export('Lexicon.Automate',Automato);});yum.define([],function(){class Lyrics extends Pi.Class{instances(){this._titulo='';this._versao='';this._youtube='';this._tokens=[];this._numCoro=0;this._numEstrofe=0;this._numPonte=0;};get text(){var text=[];text.push(`nome\n${this.titulo}`);text.push(`\n\nversao\n${this.versao}`);for(let i=0;i<this._tokens.length;i++){const token=this._tokens[i];const key=token.key.replace(/\d+/gi,'');const value=token.value;if(token.isTitle){text.push(`\n\n${key}`);if(value.length>0){text.push(`\n${value}`);}}else{text.push(`\n${key}\n${value}`);}};return text.join('');};trocarTom(newTom){if(newTom.length==0)return;if(newTom==this._tom)return;var escalaMaiorNatural={'A':['A','A#','B','C','C#','D','D#','E','F','F#','G','G#'],'A#':['A#','B','C','C#','D','D#','E','F','F#','G','G#','A'],'B':['B','C','C#','D','D#','E','F','F#','G','G#','A','A#'],'C':['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'],'C#':['C#','D','D#','E','F','F#','G','G#','A','A#','B','C'],'D':['D','D#','E','F','F#','G','G#','A','A#','B','C','C#'],'D#':['D#','E','F','F#','G','G#','A','A#','B','C','C#','D'],'E':['E','F','F#','G','G#','A','A#','B','C','C#','D','D#'],'F':['F','F#','G','G#','A','A#','B','C','C#','D','D#','E'],'F#':['F#','G','G#','A','A#','B','C','C#','D','D#','E','F'],'G':['G','G#','A','A#','B','C','C#','D','D#','E','F','F#'],'G#':['G#','A','A#','B','C','C#','D','D#','E','F','F#','G']};var oldNotes=escalaMaiorNatural[this._tom];var newNotes=escalaMaiorNatural[newTom];for(let i=0;i<this._tokens.length;i++){const token=this._tokens[i];if(token.isTitle){token.value=token.value.replace(/[A-G]#?b?/g,(note)=>{var index=oldNotes.indexOf(note);return newNotes[index];});}else{token.key=token.key.replace(/[A-G]#?b?/g,(note)=>{var index=oldNotes.indexOf(note);return newNotes[index];});}};this._tom=newTom;};add(field,value){this[field]=this.clear(value);};set youtube(value){this._youtube=value[0];};get tokens(){return this._tokens;};set musica(value){this._titulo=value[0];};set nome(value){this._titulo=value[0];};set titulo(value){this._titulo=value[0];};get titulo(){return this._titulo||'';};get versao(){return this._versao||'';};get tom(){return this._tom||'';};set versao(value){this._versao=value[0];};set intro(value){this._tokens.push({key:'INTRO',value:value[0],isBreakable:true,isTitle:true,});};set tom(value){this._tom=value[0];this._tokens.push({key:'TOM',value:value[0],isBreakable:true,isTitle:true});};addEstrofe(nome,arr,tag=''){this._tokens.push({key:nome,value:'',isBreakable:true,isTitle:true});for(let i=0;i<arr.length;i+=2){this._tokens.push({key:arr[i],value:arr[i+1],isBreakable:i>0,isTitle:false,tag:tag});}};set estrofe(estrofe){this._numEstrofe++;this.addEstrofe(`ESTROFE ${this._numEstrofe}`,this.clear(estrofe),'ESTROFE');};set ponte(ponte){this._numPonte++;this.addEstrofe(`PONTE ${this._numPonte}`,this.clear(ponte),'PONTE');};set coro(coro){this._numCoro++;this.addEstrofe(`CORO ${this._numCoro}`,this.clear(coro),'CORO');};clear(arr){for(var i=arr.length-1;i>=0;i--){if(this.isEmpty(arr[i])){arr.pop()}else{break;}};return arr;};isEmpty(linha){linha=linha.replace(/\s/gi,'');linha=linha.replace(/\t/gi,'');return linha.length==0;}};Pi.Export('Music.Lyrics',Lyrics);});yum.define([Pi.Url.create('Music','/lyrics.js'),Pi.Url.create('Lexicon','/automate.js')],function(){class Parser extends Pi.Class{instances(){this.automate=new Lexicon.Automate();this.tags=['youtube','nome','musica','titulo','intro','tom','versao','estrofe','ponte','coro'];this.automate.add(0,0,['[empty]']);this.automate.add(0,1,['estrofe','ponte','coro']);this.automate.add(1,2,['[text]']);this.automate.add(1,4,['[empty]']);this.automate.add(4,4,['[empty]']);this.automate.add(4,2,['[text]']);this.automate.add(2,2,['[text]','[empty]']);this.automate.add(2,3,['[empty]']);this.automate.add(2,3,['[done]']);this.automate.add(2,3,this.tags);this.automate.add(0,4,['youtube','nome','musica','titulo','intro','tom','versao']);this.automate.add(4,5,['[text]']);this.automate.add(4,6,['[empty]']);this.automate.add(6,6,['[empty]']);this.automate.add(6,5,['[text]']);this.automate.add(5,3,['[empty]']);this.automate.add(5,3,['[done]']);this.automate.add(5,3,this.tags);this.automate.doneOn(3);};parse(text){var lyrics=new Music.Lyrics();var linhas=text.replace(/\r/gi,'').split('\n');var values=[];this.automate.onStart(()=>{values=[];});this.automate.onDone(()=>{const events=this.automate.events;lyrics.add(events[0],values);});for(let i=0;i<linhas.length;i++){const linhaRaw=linhas[i];const linha=this.clear(linhaRaw);const event=this.convertToEvent(linha);this.automate.onStep(()=>{values.push(linhaRaw);});this.automate.onInvalid(()=>{throw'Erro na linha '+(i+1);});this.automate.trigger(event);};this.automate.onStep(null);this.automate.trigger('[done]');return lyrics;};convertToEvent(linha){if(this.tags.indexOf(linha)>-1)return linha;if(linha.length==0)return'[empty]';return'[text]';};isEmpty(linha){return linha.length==0;};clear(linha){linha=linha.replace(/\s/gi,'');linha=linha.replace(/\t/gi,'');return linha.toLowerCase();}};Pi.Export('Music.Parser',Parser);});yum.define([],function(){class Automato extends Pi.Class{instances(){this.nodes=[];this.done=-1;this.reset();};add(from,to,events){for(let i=0;i<events.length;i++){const event=events[i];this.nodes[`${from}:${event}`]=to;};return this;};doneOn(done){this.done=done;return this;};onStart(cb){this._cbStart=cb;};onStep(cb){this._cbStep=cb;};onDone(cb){this._cbDone=cb;};onInvalid(cb){this._cbInvalid=cb;};trigger(event){if(!this.exist(this.current,event)){this.current=-1;if(this._cbInvalid)this._cbInvalid();return;};const from=this.current;const to=this.get(from,event);if(from==0&&to>0){this.reset();if(this._cbStart)this._cbStart(event);}else if(from>0&&to>0){if(this._cbStep)this._cbStep(event);};this.events.push(event);this.current=to;if(this.isDone()){if(this._cbDone)this._cbDone();this.reset();}};reset(){this.current=0;this.events=[];return this;};get(from,event){return this.nodes[`${from}:${event}`];};exist(from,event){return this.get(from,event)!==undefined;};isValid(){return this.current!=-1;};isDone(){return this.current==this.done;}};Pi.Export('Lexicon.Automate',Automato);});yum.define([],function(){class Lyrics extends Pi.Class{instances(){this._titulo='';this._versao='';this._youtube='';this._tokens=[];this._numCoro=0;this._numEstrofe=0;this._numPonte=0;};get text(){var text=[];text.push(`nome\n${this.titulo}`);text.push(`\n\nversao\n${this.versao}`);for(let i=0;i<this._tokens.length;i++){const token=this._tokens[i];const key=token.key.replace(/\d+/gi,'');const value=token.value;if(token.isTitle){text.push(`\n\n${key}`);if(value.length>0){text.push(`\n${value}`);}}else{text.push(`\n${key}\n${value}`);}};return text.join('');};trocarTom(newTom){if(newTom.length==0)return;if(newTom==this._tom)return;var escalaMaiorNatural={'A':['A','A#','B','C','C#','D','D#','E','F','F#','G','G#'],'A#':['A#','B','C','C#','D','D#','E','F','F#','G','G#','A'],'B':['B','C','C#','D','D#','E','F','F#','G','G#','A','A#'],'C':['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'],'C#':['C#','D','D#','E','F','F#','G','G#','A','A#','B','C'],'D':['D','D#','E','F','F#','G','G#','A','A#','B','C','C#'],'D#':['D#','E','F','F#','G','G#','A','A#','B','C','C#','D'],'E':['E','F','F#','G','G#','A','A#','B','C','C#','D','D#'],'F':['F','F#','G','G#','A','A#','B','C','C#','D','D#','E'],'F#':['F#','G','G#','A','A#','B','C','C#','D','D#','E','F'],'G':['G','G#','A','A#','B','C','C#','D','D#','E','F','F#'],'G#':['G#','A','A#','B','C','C#','D','D#','E','F','F#','G']};var oldNotes=escalaMaiorNatural[this._tom];var newNotes=escalaMaiorNatural[newTom];for(let i=0;i<this._tokens.length;i++){const token=this._tokens[i];if(token.isTitle){token.value=token.value.replace(/[A-G]#?b?/g,(note)=>{var index=oldNotes.indexOf(note);return newNotes[index];});}else{token.key=token.key.replace(/[A-G]#?b?/g,(note)=>{var index=oldNotes.indexOf(note);return newNotes[index];});}};this._tom=newTom;};add(field,value){this[field]=this.clear(value);};set youtube(value){this._youtube=value[0];};get tokens(){return this._tokens;};set musica(value){this._titulo=value[0];};set nome(value){this._titulo=value[0];};set titulo(value){this._titulo=value[0];};get titulo(){return this._titulo||'';};get versao(){return this._versao||'';};get tom(){return this._tom||'';};set versao(value){this._versao=value[0];};set intro(value){this._tokens.push({key:'INTRO',value:value[0],isBreakable:true,isTitle:true,});};set tom(value){this._tom=value[0];this._tokens.push({key:'TOM',value:value[0],isBreakable:true,isTitle:true});};addEstrofe(nome,arr,tag=''){this._tokens.push({key:nome,value:'',isBreakable:true,isTitle:true});for(let i=0;i<arr.length;i+=2){this._tokens.push({key:arr[i],value:arr[i+1],isBreakable:i>0,isTitle:false,tag:tag});}};set estrofe(estrofe){this._numEstrofe++;this.addEstrofe(`ESTROFE ${this._numEstrofe}`,this.clear(estrofe),'ESTROFE');};set ponte(ponte){this._numPonte++;this.addEstrofe(`PONTE ${this._numPonte}`,this.clear(ponte),'PONTE');};set coro(coro){this._numCoro++;this.addEstrofe(`CORO ${this._numCoro}`,this.clear(coro),'CORO');};clear(arr){for(var i=arr.length-1;i>=0;i--){if(this.isEmpty(arr[i])){arr.pop()}else{break;}};return arr;};isEmpty(linha){linha=linha.replace(/\s/gi,'');linha=linha.replace(/\t/gi,'');return linha.length==0;}};Pi.Export('Music.Lyrics',Lyrics);});yum.define([],function(){class Model extends Pi.Model.Abstract{instances(){};init(){super.init(Pi.Url.create(App.getConfig('netune.api'),'/musica'));};validators(add){add({});};initWithJson(json){super.initWithJson(json);return this;};actions(add){super.actions(add);add({get:'GET:/get?id=:id',all:'GET:/all'});}};Pi.Export('Music.Model',Model);});};